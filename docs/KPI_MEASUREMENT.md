# KPI 측정 방법 정의서 (KPI Measurement Methods)

## 문서 목적
영양사 식단 자동 생성 플랫폼의 성공 지표(KPI)를 정의하고,
각 지표의 측정 방법, 목표 값, 데이터 수집 방식을 명확히 합니다.

---

## KPI 개요

본 플랫폼의 성공은 다음 4가지 핵심 지표로 측정됩니다:

1. **식단 편성 소요 시간 감소율**
2. **영양사 수정 빈도 감소**
3. **월간 활성 영양사 수**
4. **재사용률**

---

## 1. 식단 편성 소요 시간 감소율

### 정의
영양사가 월간 식단표를 완성하는 데 걸리는 시간이 기존 방식(엑셀) 대비 얼마나 감소했는지를 측정하는 지표

### 측정 방법

#### 기존 방식 (엑셀 기준) 소요 시간
- **데이터 수집 방법**: 사용자 설문조사
- **수집 시점**: 회원가입 또는 첫 식단 생성 시
- **질문 예시**:
  - "기존 엑셀 방식으로 월간 식단표를 작성할 때 평균적으로 얼마나 걸렸나요?"
  - 선택지: 1시간 미만 / 1-2시간 / 2-4시간 / 4-8시간 / 8시간 이상

#### 플랫폼 사용 소요 시간
- **데이터 수집 방법**: 시스템 로그 자동 측정
- **측정 구간**:
  - 시작: 식단 생성 요청 시작 시점 (`POST /api/meal-plans/generate` 호출)
  - 종료: 영양사가 식단을 확정 상태로 변경한 시점 (`PUT /api/meal-plans/{id}/status` → `confirmed`)
- **수정 시간 포함**: 자동 생성 후 영양사가 수정하는 시간 포함

#### 계산 공식
```
감소율 (%) = ((기존 소요 시간 - 플랫폼 소요 시간) / 기존 소요 시간) × 100
```

### 데이터 저장 구조

#### 테이블: `meal_plan_time_tracking`
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | BIGINT | 기본키 |
| meal_plan_id | BIGINT | 식단 ID (FK) |
| user_id | BIGINT | 영양사 ID (FK) |
| started_at | TIMESTAMP | 식단 생성 시작 시각 |
| generated_at | TIMESTAMP | 자동 생성 완료 시각 |
| confirmed_at | TIMESTAMP | 영양사 확정 시각 |
| total_edit_time_seconds | INTEGER | 총 수정 시간 (초) |
| baseline_time_hours | DECIMAL | 기존 방식 소요 시간 (시간) |

### 목표 값
- **MVP 출시 1개월 후**: 평균 30% 감소
- **MVP 출시 3개월 후**: 평균 50% 감소
- **MVP 출시 6개월 후**: 평균 60% 감소

### 측정 주기
- 주간 단위로 집계
- 월간 리포트 생성
- 분기별 트렌드 분석

---

## 2. 영양사 수정 빈도 감소

### 정의
자동 생성된 식단에 대해 영양사가 수정하는 횟수 및 비율을 측정하여,
자동 생성 품질 개선 정도를 평가하는 지표

### 측정 방법

#### 수정 빈도 측정
- **단위**: 식단 항목(meal_item) 기준
- **수정 유형**:
  1. 메뉴 변경 (밥/국/반찬 교체)
  2. 식재료 교체
  3. 가격 조정
  4. 날짜별 식단 전체 재생성

#### 측정 지표
1. **항목별 수정률**: 자동 생성된 전체 식단 항목 중 수정된 항목 비율
2. **평균 수정 횟수**: 식단 1개당 평균 수정 횟수
3. **수정 없이 확정**: 자동 생성 후 수정 없이 바로 확정한 식단 비율

#### 계산 공식
```
항목별 수정률 (%) = (수정된 항목 수 / 전체 생성 항목 수) × 100

평균 수정 횟수 = 총 수정 횟수 / 생성된 식단 수

수정 없이 확정률 (%) = (수정 없이 확정한 식단 수 / 전체 확정 식단 수) × 100
```

### 데이터 저장 구조

#### 테이블: `meal_plan_history`
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | BIGINT | 기본키 |
| meal_plan_id | BIGINT | 식단 ID (FK) |
| meal_item_id | BIGINT | 식단 항목 ID (FK, nullable) |
| user_id | BIGINT | 영양사 ID (FK) |
| action_type | VARCHAR | 액션 유형 (generate, edit_menu, edit_ingredient, regenerate) |
| changed_at | TIMESTAMP | 변경 시각 |
| before_value | JSONB | 변경 전 값 |
| after_value | JSONB | 변경 후 값 |
| reason | TEXT | 수정 사유 (선택사항) |

### 목표 값
- **MVP 출시 1개월 후**: 항목별 수정률 < 40%
- **MVP 출시 3개월 후**: 항목별 수정률 < 30%
- **MVP 출시 6개월 후**: 항목별 수정률 < 20%
- **최종 목표**: 수정 없이 확정률 > 30%

### 측정 주기
- 식단 확정 시마다 집계
- 주간 단위 평균 계산
- 월간 트렌드 분석

---

## 3. 월간 활성 영양사 수 (MAU - Monthly Active Users)

### 정의
매월 1회 이상 로그인하여 플랫폼을 사용한 영양사 수를 측정하는 지표

### 측정 방법

#### 활성 사용자 정의
다음 중 하나 이상의 행동을 한 영양사:
1. 로그인 (인증 성공)
2. 식단 조회
3. 식단 생성 요청
4. 식단 수정
5. 파일 업로드

#### 측정 방법
- **데이터 수집**: 사용자 활동 로그 자동 기록
- **집계 주기**: 매월 1일 00:00 기준
- **집계 범위**: 전월 1일 00:00 ~ 전월 말일 23:59:59

### 데이터 저장 구조

#### 테이블: `user_activity_log`
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | BIGINT | 기본키 |
| user_id | BIGINT | 영양사 ID (FK) |
| activity_type | VARCHAR | 활동 유형 (login, view, create, edit, upload) |
| activity_at | TIMESTAMP | 활동 시각 |
| ip_address | INET | IP 주소 |
| user_agent | TEXT | User Agent |

#### 테이블: `monthly_active_users`
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | BIGINT | 기본키 |
| year_month | DATE | 연월 (YYYY-MM-01) |
| total_active_users | INTEGER | 총 활성 사용자 수 |
| new_users | INTEGER | 신규 가입자 수 |
| returning_users | INTEGER | 재방문 사용자 수 |
| churned_users | INTEGER | 이탈 사용자 수 (전월 활성, 당월 비활성) |

### 계산 공식
```
MAU = 해당 월에 1회 이상 활동한 고유 영양사 수

재방문률 (%) = (재방문 사용자 수 / 총 활성 사용자 수) × 100

이탈률 (%) = (이탈 사용자 수 / 전월 활성 사용자 수) × 100
```

### 목표 값
- **MVP 출시 1개월 후**: MAU 10명
- **MVP 출시 3개월 후**: MAU 30명
- **MVP 출시 6개월 후**: MAU 50명
- **MVP 출시 12개월 후**: MAU 100명
- **재방문률**: 70% 이상 유지

### 측정 주기
- 매월 1일 자동 집계
- 월간 리포트 생성
- 분기별 성장률 분석

---

## 4. 재사용률

### 정의
영양사가 과거에 생성한 식단 데이터를 재사용하는 비율을 측정하는 지표
(플랫폼의 장기 가치 및 학습 효과를 나타냄)

### 측정 방법

#### 재사용 정의
다음 중 하나 이상에 해당:
1. **과거 식단 복사**: 이전 달 식단을 복사하여 새 식단 생성
2. **메뉴 재사용**: 과거 식단에서 메뉴 항목을 현재 식단으로 드래그 앤 드롭
3. **식재료 재사용**: 과거에 사용한 식재료를 즐겨찾기하여 재사용
4. **패턴 학습**: 자동 생성 시 자신의 과거 식단 패턴 활용

#### 측정 지표
1. **식단 복사율**: 복사 기능으로 생성된 식단 비율
2. **메뉴 재사용률**: 과거 메뉴를 재사용한 항목 비율
3. **즐겨찾기 활용률**: 즐겨찾기 식재료 사용 비율
4. **패턴 기반 생성률**: 과거 식단 분석 기반 자동 생성 비율

#### 계산 공식
```
식단 복사율 (%) = (복사로 생성된 식단 수 / 전체 생성 식단 수) × 100

메뉴 재사용률 (%) = (재사용된 메뉴 항목 수 / 전체 메뉴 항목 수) × 100

즐겨찾기 활용률 (%) = (즐겨찾기 식재료 사용 횟수 / 전체 식재료 사용 횟수) × 100

패턴 기반 생성률 (%) = (과거 분석 기반 생성 식단 수 / 전체 자동 생성 식단 수) × 100

종합 재사용률 (%) = (재사용 관련 활동 횟수 / 전체 식단 편성 활동 횟수) × 100
```

### 데이터 저장 구조

#### 테이블: `meal_plan_reuse_tracking`
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | BIGINT | 기본키 |
| meal_plan_id | BIGINT | 식단 ID (FK) |
| user_id | BIGINT | 영양사 ID (FK) |
| reuse_type | VARCHAR | 재사용 유형 (copy, menu_reuse, favorite, pattern) |
| source_meal_plan_id | BIGINT | 원본 식단 ID (FK, nullable) |
| source_item_id | BIGINT | 원본 항목 ID (FK, nullable) |
| reused_at | TIMESTAMP | 재사용 시각 |

#### 테이블: `user_favorites`
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | BIGINT | 기본키 |
| user_id | BIGINT | 영양사 ID (FK) |
| item_type | VARCHAR | 항목 유형 (meal_item, ingredient) |
| item_id | BIGINT | 항목 ID |
| added_at | TIMESTAMP | 즐겨찾기 추가 시각 |
| usage_count | INTEGER | 사용 횟수 |

### 목표 값
- **MVP 출시 3개월 후**: 종합 재사용률 > 20%
- **MVP 출시 6개월 후**: 종합 재사용률 > 40%
- **MVP 출시 12개월 후**: 종합 재사용률 > 60%
- **즐겨찾기 활용률**: > 30%

### 측정 주기
- 재사용 행동 발생 시마다 기록
- 주간 단위 집계
- 월간 리포트 생성

---

## KPI 대시보드 구성

### 실시간 대시보드
**위치**: 관리자 페이지 (`/admin/dashboard`)

**표시 항목**:
1. 오늘의 활성 사용자 수
2. 이번 주 생성된 식단 수
3. 평균 식단 생성 시간
4. 평균 수정률

### 주간 리포트
**발송 대상**: 프로젝트 팀, 이해관계자

**포함 내용**:
1. 주간 활성 사용자 수 (전주 대비 증감)
2. 주간 평균 식단 생성 시간
3. 주간 평균 수정률
4. 주요 이슈 및 개선 사항

### 월간 리포트
**발송 대상**: 전사, 투자자

**포함 내용**:
1. MAU 및 성장률
2. 평균 식단 편성 소요 시간 감소율
3. 영양사 수정 빈도 트렌드
4. 재사용률 트렌드
5. 사용자 피드백 요약
6. 다음 달 개선 계획

---

## 데이터 수집 및 프라이버시

### 개인정보 보호
- 모든 로그 데이터는 익명화 처리 (필요시 pseudonymization)
- 영양사 개인 식별 정보는 암호화 저장
- GDPR/개인정보보호법 준수

### 데이터 보관 정책
- 활동 로그: 2년 보관 후 집계 데이터만 유지
- 식단 이력: 영구 보관 (영양사 요청 시 삭제)
- KPI 집계 데이터: 영구 보관

### 사용자 동의
- 회원가입 시 데이터 수집 및 분석 동의 필수
- 언제든지 데이터 삭제 요청 가능

---

## 측정 도구 및 기술 스택

### Backend
- **로깅**: Python logging + JSON formatter
- **저장**: PostgreSQL
- **집계**: SQL + Pandas
- **스케줄링**: Celery + Redis (크론 작업)

### Frontend
- **이벤트 추적**: Custom event tracking (API 호출)
- **UI 이벤트**: 클릭, 드래그, 입력 등 주요 인터랙션

### 대시보드
- **Backend**: FastAPI + SQLAlchemy
- **Frontend**: React + Chart.js 또는 Recharts
- **자동 갱신**: WebSocket 또는 Server-Sent Events (SSE)

---

## KPI 검토 및 개선 프로세스

### 주간 검토 회의
- **참석자**: 프로젝트 팀
- **안건**:
  - 주간 KPI 현황
  - 목표 대비 달성률
  - 이슈 및 개선 방안

### 월간 회고
- **참석자**: 프로젝트 팀, 이해관계자
- **안건**:
  - 월간 KPI 종합 분석
  - 사용자 피드백 리뷰
  - 다음 달 목표 설정
  - 기능 개선 우선순위 조정

### 분기별 전략 회의
- **참석자**: 경영진, 프로젝트 팀
- **안건**:
  - 분기 KPI 종합 평가
  - 시장 트렌드 분석
  - 확장 전략 수립
  - 예산 및 리소스 계획

---

## 참고 문서
- [PRD.md](./PRD.md) - 제품 요구사항 정의서
- [MVP_SCOPE.md](./MVP_SCOPE.md) - MVP 기능 범위 명세서
- [task.md](./task.md) - 개발 Task 관리
